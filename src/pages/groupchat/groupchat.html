<!--
  Generated template for the GroupchatPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar color="hcolor" text-center>
    <ion-title>{{groupdisplayname}}</ion-title>
    <small style="color:beige;" >
      <i *ngIf="groupnberofmembers>15">{{groupnberofmembers}} participants</i>
      <i *ngIf="!groupnberofmembers||groupnberofmembers<=15">Groupe de discussion</i>
    </small>
    <ion-buttons end>
      <button  ion-button icon-only (click)="openGroupeSetting()">
        <ion-icon name="md-options"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>
<!--ion-content #content >
  <ion-item *ngIf="(sendToAdmin||!meingroup)&&!isExpired(abonnement)" class="send-message" text-wrap>
  <ion-icon name="person" item-left></ion-icon>
  <p>Vous écrivez à un responsable enseignant. Les autres participants ne verront pas ce message.</p>
  </ion-item>
  <ion-item  *ngIf="(sendToAdmin||!meingroup)&&isExpired(abonnement)" class="send-message" text-wrap>
    <ion-icon name="ios-alert" color="danger" item-left></ion-icon>
    <p>Votre inscription au programme est arrivée à expiration et vous n'avez plus accès à certaines fonctionnalités de ce groupe.
       Vous ne pouvez plus parler directement à un enseignant, recevoir leur message, et bien d'autres.  
      </p>
  </ion-item>
  <ion-item *ngIf="meingroup&&meingroup.blocked" class="send-message" text-wrap>
    <ion-icon name="md-alert" color="danger" item-left></ion-icon>
    <p>Vous êtes bloqué et  ne pouvez plus participer aux discussions dans ce groupe.
      Le blockage survient si vos pratiques vont à l'encontre des règle chez centor. 
      Vous pouvez être bloqué si vous utilisez des expressions liées à la violence, 
      à la dégradation de la personne humaine, ou à des substances interdites.
    </p>
  </ion-item>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)" position='top'>
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>

<div class="message-wrap" [hidden]="!allgroupmsgs">
    <div *ngFor="let item of allgroupmsgs; let i = index" class="message" [class.right]="item.sentby === alignuid" [class.left]="(item.sentby != alignuid)&&!item.message.fromAdmin"  [class.fromadmin]="item.message.fromAdmin">
      <img class="user-img" [src]="item.photoURL" alt="" [hidden]="item.sentby === alignuid">
      <div class="msg-detail">
        <div class="msg-info">
          <p>
            <strong *ngIf="item.sentby != alignuid">{{item.displayName| limitTo:15}} </strong>
            <strong *ngIf="item.sentby === alignuid">Vous </strong>
            &nbsp;&nbsp;&nbsp;{{item.timestamp| relativeTime}}
            </p>
        </div>
        <div class="msg-content" (press)="presentSheet(item.message)">
          <span class="triangle"></span>           
           <ion-item *ngIf="item.message.fileurl"  no-lines (click)="download(item.message)" >
            <img [src]="item.message.fileurl" *ngIf="item.message.type=='image'">
               <ion-thumbnail item-left *ngIf="item.message.type=='file'">
                      <img src="assets/images/file-image.png">
               </ion-thumbnail>
              <p *ngIf="item.message.type=='file'">Document</p>
           </ion-item>
           <question-view *ngIf="item.message.type=='question'" [question]="item.message.question"></question-view>
           <p class="line-breaker" [innerHTML]="item.message.text"></p>
        </div>
      </div>
    </div>
  </div>

  <ion-grid [hidden]="allgroupmsgs" style=" height: 100%;justify-content: center;">
    <ion-row justify-content-center align-items-center>
      <ion-spinner name="dots"></ion-spinner>
    </ion-row>
  </ion-grid>
  <ion-item  class="file-preview" *ngIf="fileurl">
        <ion-thumbnail item-left *ngIf="mesagetype=='file'">
          <img src="assets/images/file-image.png">
        </ion-thumbnail>
        <ion-thumbnail item-left *ngIf="mesagetype=='image'">
            <img [src]="fileurl">
        </ion-thumbnail>
      <span *ngIf="mesagetype=='file'">Document</span>
      <span *ngIf="mesagetype=='image'">Image</span>
        <p>Saisir une legende </p>
  <button ion-button item-right  clear icon-only (click)="cancelFile()" item-right class="button-close">
    <ion-icon  name="ios-close-circle-outline"></ion-icon>
  </button>
  </ion-item>
</ion-content>-->
<ion-content class="bg-white">
  <ion-item *ngIf="(sendToAdmin||!meingroup)&&!isExpired(abonnement)" class="send-message" text-wrap no-border>
    <ion-icon name="person" item-left></ion-icon>
    <p>Vous écrivez à un responsable enseignant. Les autres participants ne verront pas ce message.</p>
  </ion-item>
  <ion-item *ngIf="(sendToAdmin||!meingroup)&&isExpired(abonnement)" class="send-message" text-wrap>
    <ion-icon name="ios-alert" color="danger" item-left></ion-icon>
    <p>Votre inscription au programme est arrivée à expiration et vous n'avez plus accès à certaines fonctionnalités de ce groupe.
      Vous ne pouvez plus parler directement à un enseignant, recevoir leur message, et bien d'autres.
    </p>
  </ion-item>
  <ion-item *ngIf="meingroup&&meingroup.blocked" class="send-message" text-wrap no-border>
    <ion-icon name="md-alert" color="danger" item-left></ion-icon>
    <p>Vous êtes bloqué et ne pouvez plus participer aux discussions dans ce groupe. Le blockage survient si vos pratiques vont
      à l'encontre des règle chez centor. Vous pouvez être bloqué si vous utilisez des expressions liées à la violence, à la
      dégradation de la personne humaine, ou à des substances interdites.
    </p>
  </ion-item>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)" position='top'>
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>
<div class=" message-wrap">
  <div *ngFor="let item of allgroupmsgs" class="message-wrapper message-wrap" on-hold="onMessageHold($event, $index, item)">
    <div *ngIf="item.message.fromAdmin">
      <img (click)="viewProfile(item)" class="profile-pic left" [src]="item.photoURL"  />
      <!--  wave-->
      <div class="chat-bubble admin slide-left">
            <ion-item *ngIf="item.message.fileurl" no-lines (click)="download(item.message)">
              <img [src]="item.message.fileurl" *ngIf="item.message.type=='image'">
              <ion-thumbnail item-left *ngIf="item.message.type=='file'">
                <img src="assets/images/file-image.png">
              </ion-thumbnail>
              <p *ngIf="item.message.type=='file'">Document</p>
            </ion-item>
<question-view *ngIf="item.message.type=='question'" [question]="item.message.question"></question-view>
        <div class="message" [innerHTML]="item.message.text" autolinker>
        </div>

        <div class="message-detail">
          <span (click)="viewProfile(item)" class="bold">{{item.displayName| limitTo:15}}</span>,
          <small>&nbsp;&nbsp;&nbsp;{{item.timestamp| relativeTime}}</small>
        </div>

      </div>
    </div>
    <div *ngIf="(item.sentby != alignuid)&&!item.message.fromAdmin">
      <img (click)="viewProfile(item)" class="profile-pic left" [src]="item.photoURL" />
      <!--  wave-->
      <div class="chat-bubble left slide-left">
          <ion-item *ngIf="item.message.fileurl" no-lines (click)="download(item.message)">
            <img [src]="item.message.fileurl" *ngIf="item.message.type=='image'">
            <ion-thumbnail item-left *ngIf="item.message.type=='file'">
              <img src="assets/images/file-image.png">
            </ion-thumbnail>
            <p *ngIf="item.message.type=='file'">Document</p>
          </ion-item>
    <question-view *ngIf="item.message.type=='question'" [question]="item.message.question"></question-view>
        <div class="message" [innerHTML]="item.message.text" autolinker>
        </div>
    
        <div class="message-detail">
          <span (click)="viewProfile(item)" class="bold">{{item.displayName| limitTo:15}}</span>,
          <small>&nbsp;&nbsp;&nbsp;{{item.timestamp| relativeTime}}</small>
        </div>
    
      </div>
    </div>
    <div *ngIf="item.sentby === alignuid">

      <img (click)="viewProfile(item)" class="profile-pic right" [src]="photoURL" />

      <div class="chat-bubble right slide-right">
          <ion-item *ngIf="item.message.fileurl" no-lines (click)="download(item.message)">
            <img [src]="item.message.fileurl" *ngIf="item.message.type=='image'">
            <ion-thumbnail item-left *ngIf="item.message.type=='file'">
              <img src="assets/images/file-image.png">
            </ion-thumbnail>
            <p *ngIf="item.message.type=='file'">Document</p>
          </ion-item>
<question-view *ngIf="item.message.type=='question'" [question]="item.message.question"></question-view>
        <div class="message" [innerHTML]="item.message.text" autolinker>
        </div>

        <div class="message-detail">
          <span (click)="viewProfile(message)" class="bold">Moi</span>,
          <small item-right>&nbsp;&nbsp;&nbsp;{{item.timestamp| relativeTime}}</small>
        </div>

      </div>

    </div>

    <div class="cf"></div>

  </div>
  </div>
  <ion-item class="file-preview" *ngIf="fileurl">
    <ion-thumbnail item-left *ngIf="mesagetype=='file'">
      <img src="assets/images/file-image.png">
    </ion-thumbnail>
    <ion-thumbnail item-left *ngIf="mesagetype=='image'">
      <img [src]="fileurl">
    </ion-thumbnail>
    <span *ngIf="mesagetype=='file'">Document</span>
    <span *ngIf="mesagetype=='image'">Image</span>
    <p>Saisir une legende </p>
    <button ion-button item-right clear icon-only (click)="cancelFile()" item-right class="button-close">
      <ion-icon name="ios-close-circle-outline"></ion-icon>
    </button>
  </ion-item>
</ion-content>

<ion-footer no-border [style.height]="showEmojiPicker ? '255px' : '55px'">  
<ion-grid class="input-wrap"no-border >
  <ion-row>
    <ion-col col-1>
      <button ion-button small clear icon-only item-right (click)="switchEmojiPicker()">
        <ion-icon name="md-happy"></ion-icon>
      </button>
    </ion-col>
    <ion-col col-1>
      <button ion-button clear small icon-only item-right (click)="toggleDest()" *ngIf="sendToAdmin||!meingroup" [disabled]="!meingroup">
        <ion-icon name="ios-chatboxes"></ion-icon>
      </button>
      <button ion-button clear small icon-only item-right (click)="toggleDest()" *ngIf="!sendToAdmin&&meingroup">
        <ion-icon name="ios-chatboxes-outline"></ion-icon>
      </button>
    </ion-col>
    <ion-col col-8>
      <ion-textarea #chat_input placeholder="Saisir un message" [(ngModel)]="newmessage" (keyup.enter)="addgroupmsg()" (ionFocus)="onFocus()" autosize>
      </ion-textarea>
    </ion-col>
    <ion-col col-2>
      <button ion-button clear icon-only item-right (click)="addgroupmsg()" [hidden]="(!newmessage&&!fileurl)||sendToAdmin&&isExpired(abonnement)">
        <ion-icon name="ios-send" ios="ios-send" md="md-send"></ion-icon>
      </button>
      <button ion-button clear icon-only item-right (click)="presentSheetSendFile()" [hidden]="!((!newmessage&&!fileurl)||sendToAdmin&&isExpired(abonnement))">
        <ion-icon name="ios-send" ios="ios-attach" md="md-attach"></ion-icon>
      </button>
    </ion-col>
  </ion-row>
</ion-grid>
    <emoji-picker *ngIf="showEmojiPicker" [(ngModel)]="newmessage"></emoji-picker>
</ion-footer>
